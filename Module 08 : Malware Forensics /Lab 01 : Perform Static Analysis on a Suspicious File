ğŸ¯ Objective
Perform static malware analysis on a suspicious Windows executable to:
Detect hidden or encrypted code (packers/obfuscation)
Identify suspicious indicators
Analyze PE headers and sections
Extract and interpret malicious strings
Identify linked libraries and dependencies
Disassemble executable code to understand behavior

ğŸ§° Tools Used
PEiD
PeStudio
Dependency Walker
IDA Pro

ğŸ“Œ Procedure (Key Steps)

ğŸ” Step 1 â€“ Detect Packing & Obfuscation (PEiD)
Loaded njrat.exe into PEiD
Scanned for cryptors, packers, and hidden code
Results:
Entry Point section: .text
No packer detected
Compiled using Microsoft Visual C#/.NET framework
â¡ï¸ File is not obfuscated â€” safe to proceed with static analysis.

ğŸš© Step 2 â€“ Identify Malicious Indicators (PeStudio)
Opened file in PeStudio
Reviewed basic metadata
Switched to Indicators section
Findings:
Multiple suspicious elements flagged
High risk score indicating malicious behavior

ğŸ“¦ Step 3 â€“ Analyze PE Headers & Sections (PeStudio)
ğŸ”¹ Optional Header Analysis
Magic Number: 0x010B â†’ PE32 executable
Entry Point: 0x0000747E
Base of Code: 0x00002000
Initialized Data Size: 1536 bytes
Uninitialized Data: 0 bytes
OS Version: 4.0 (default)

ğŸ”¹ Section Analysis
Section	Purpose
.text	Main executable code
.rsrc	Resources
.reloc	Relocation info
.text contains 91.49% of file data
Raw size > virtual size â†’ no packing
Entry point inside .text â†’ executable logic present

ğŸ§µ Step 4 â€“ Malicious Strings Analysis (PeStudio)
Total strings found: 360
Blacklisted strings: 25

ğŸ”¥ Key Suspicious Functions
ToBase64String / FromBase64String â†’ data encoding
NtSetInformationProcess â†’ DEP evasion
SetEnvironmentVariable â†’ environment manipulation
GetKeyboardState, GetAsyncKeyState â†’ keylogging
GetForegroundWindow â†’ screen activity

ğŸ§  Behavior Indicators
Modifies Windows Firewall using netsh
Persistence via:
Software\Microsoft\Windows\CurrentVersion\Run

Creates malicious files:
j.exe
Server.exe

Collects:
Machine name
Username
OS version
File system metadata
Date & time

â¡ï¸ Strong evidence of spyware + keylogger functionality

ğŸ”— Step 5 â€“ Dependency Analysis (Dependency Walker)
ğŸ“š Key DLL Behaviors
Kernel32.dll Imports
CreateFileW, CreateFileMappingW â†’ file creation/loading
CreateMutexW â†’ single malware instance
CreateToolhelp32Snapshot â†’ process enumeration
Registry Manipulation
RegOpenKeyExW
RegQueryValueExW
RegEnumKeyExW
RegCloseKey

â¡ï¸ Used for persistence & system modification
Networking
URLOpenBlockingStreamW â†’ remote data download
Hashing
MD5 hashing functions in ADVAPI.dll

ğŸ§¬ Step 6 â€“ Code Disassembly (IDA Pro)
Loaded executable as PE for 80386
Enabled:
Load resources
Rename DLL entries
Create import segments

ğŸ” Key Observations
_CorExeMain function located at 00402000
Linked to MSCOREE.DLL (.NET runtime)
Cross-referenced in .text segment
Confirmed executable control flow

ğŸ” Findings

The file njrat.exe is confirmed malware with the following capabilities:

âœ… Keylogging
âœ… Screen capture
âœ… Process monitoring
âœ… File manipulation
âœ… Firewall modification
âœ… Registry persistence
âœ… Remote C2 communication
âœ… Data encoding & exfiltration

C2 Connection:
IP: 10.0.0.16
Port: 1177
Persistence Method: Software\Microsoft\Windows\CurrentVersion\Run
Dropped Files: Server.exe (Temp directory), j.exe

ğŸ“š Lessons Learned
PE structure analysis quickly reveals executable behavior
Strings often expose malware functionality clearly
Dependency analysis shows persistence & data theft methods
Disassembly confirms runtime execution flow
Static analysis alone can fully classify many malware samples
