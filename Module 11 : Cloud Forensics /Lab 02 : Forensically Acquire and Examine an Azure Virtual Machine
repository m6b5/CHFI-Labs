ğŸ¯ Objective
When a virtual machine in Microsoft Azure is compromised, forensic investigators must preserve its disk data in a forensically sound manner.

The objectives of this lab are to:
Create a snapshot of an affected Azure VMâ€™s OS disk, securely copy it to an Azure storage account, mount it on a forensic workstation, and analyze the disk image
using Autopsy to recover malicious artifacts.

ğŸ§° Tools Used
Microsoft Azure Portal & Azure CLI
Azure File Share (Storage Account)
Windows Server 2022 Forensic Workstation
Autopsy (Digital Forensics Platform)
VirusTotal (Malware analysis)

ğŸ“Œ Scenario Overview
An attacker injects a malicious file into a production Azure VM.
A forensic investigator:
Creates a forensic snapshot of the OS disk
Copies it to a secure storage account
Mounts the snapshot on a forensic workstation
Extracts malicious artifacts
Confirms malicious behavior using threat intelligence

ğŸ§ª Procedure
ğŸ”¹ Task 1 â€“ Environment Setup
Created two Azure resource groups:
Resource Group	Purpose
Production	Compromised VM
chfi-investigation	Forensic storage & analysis

Created Linux VM azure-ubuntu in Production group.

ğŸ”¹ Task 2 â€“ File Injection Attack Simulation
Attacker transferred malicious file:
scp Infected.docx James@<Public_IP>:/home/James

Simulates real-world insider or external compromise.

ğŸ”¹ Task 3 â€“ OS Disk Snapshot Creation
Using Azure CLI:
az vm show --resource-group Production --name azure-ubuntu --query "storageProfile.osDisk.name"
az snapshot create \
  --resource-group Production \
  --name evidencesnapshot \
  --location eastus \
  --source <OS_Disk_Name>

ğŸ”¹ Task 4 â€“ Secure Snapshot Access (SAS URI)
Generated temporary read-only access:
az snapshot grant-access \
  --resource-group Production \
  --name evidencesnapshot \
  --duration-in-seconds 3600 \
  --access-level read

ğŸ”¹ Task 5 â€“ Storage Account & File Share Creation
az storage account create \
  --resource-group chfi-investigation \
  --name chfifilestorage \
  --location eastus \
  --kind storageV2 \
  --sku Standard_LRS

az storage share create \
  --account-name chfifilestorage \
  --name chfifileshare

ğŸ”¹ Task 6 â€“ Snapshot Copy to Forensic Storage
az storage file copy start \
  --source-uri "<SAS_URI>" \
  --destination-share chfifileshare \
  --destination-path azureevidencefile.dd

Verified copy status until success.

Deleted snapshot from Production environment after expiration for security.

ğŸ”¹ Task 7 â€“ Mounting Evidence to Forensic Workstation
Mounted Azure File Share as network drive on Windows Server 2022 via PowerShell.

ğŸ”¹ Task 8 â€“ Forensic Analysis with Autopsy
Steps:
Loaded azureevidencefile.dd into Autopsy
Identified Linux root filesystem volume

Navigated:
/home/James/

Recovered malicious file:
Infected.docx

ğŸ” Malware Verification
Exported Infected.docx from evidence image
Uploaded to VirusTotal
Confirmed malicious indicators

ğŸ” Findings
âœ” Successful forensic acquisition of Azure VM OS disk
âœ” Malicious file recovered from disk image
âœ” Cloud-native evidence preservation achieved
âœ” Secure evidence transfer via SAS & storage account
âœ” Threat confirmed via external intelligence

ğŸ“š Lessons Learned
Azure disk snapshots act as forensic disk images
SAS URIs allow controlled evidence access
Evidence should be isolated from production resources
Cloud storage simplifies forensic transport
Autopsy can analyze cloud-acquired images effectively
Threat intelligence enhances investigation accuracy
